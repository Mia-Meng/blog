---
layout:     post
title:      函数执行上下文
subtitle:   基础及进阶
date:       2018-07-16
author:     Mia
catalog: true
tags:
    - js
    - 原创
---
## 七、函数执行上下文、执行上下文栈
[toc]

### 1.执行上下文

#### 1.1 代码分类(位置)

 * 全局代码
  * 函数(局部)代码

#### 1.2 全局执行上下文

* 在执行全局代码前将window确定为全局执行上下文
 * 对全局数据进行预处理
 * var定义的全局变量==>赋值undefined, 添加为window的属性
 * function声明的全局函数==>赋值(fun), 添加为window的方法
 * this==>赋值(window)
 * 开始执行全局代码

#### 1.3 函数执行上下文

* 在调用函数, 准备执行函数体之前, 创建对应的函数执行上下文对象(虚拟的, 存在于栈中)
 * 对局部数据进行预处理
* 形参变量==>赋值(实参)==>添加为执行上下文的属性
 * arguments==>赋值(实参列表), 添加为执行上下文的属性
 * var定义的局部变量==>undefined, 添加为执行上下文的属
 * function声明的函数 ==>赋值(fun), 添加为执行上下文的方法
  * this==>赋值(调用函数的对象)
  * 开始执行函数体代码
```javascript
console.log(a1, window.a1)
  window.a2()
  console.log(this)

  var a1 = 3
  function a2() {
    console.log('a2()')
  }
  console.log(a1)
```
 
### 2.执行上下文栈

#### 2.1 在全局代码执行前, JS引擎就会创建一个栈来存储管理所有的执行上下文对象

#### 2.2 在全局执行上下文(window)确定后, 将其添加到栈中(压栈)

#### 2.3 在函数执行上下文创建后, 将其添加到栈中(压栈)

#### 2.4 在当前函数执行完后,将栈顶的对象移除(出栈)

#### 2.5 当所有的代码执行完后, 栈中只剩下window

1. 依次输出什么?
  gb: undefined
  fb: 1
  fb: 2
  fb: 3
  fe: 3
  fe: 2
  fe: 1
  ge: 1
2. 整个过程中产生了几个执行上下文?  5
3. 伪数组有length等一般属性，但是没有数组的一般方法，没有forEach等函数，（arguments就是典型的伪数组）
